#!/bin/sh
while getopts "c:d:r:k:" opt; do
  case $opt in
    c) CLASS=${OPTARG};;
    d) DESKTOP=$OPTARG;;
    r) RUN=$OPTARG;;
    k) KEY=$OPTARG;;
  esac
done
shift $((OPTIND -1))

try_sendkey() {
  local focus_class=$(xprop -id $(xdotool getwindowfocus) WM_CLASS | cut -d '"' -f 4)
  [[ $focus_class == $CLASS ]] && { xvkbd -xsendevent -text $KEY; exit; }
}

CURR_DESK=$(xdotool get_desktop)
[[ -n $KEY ]] && try_sendkey
wid=$(xdotool search --desktop ${DESKTOP:-$CURR_DESK} --class $CLASS | tail -n 1)
[[ -n $wid ]] && { echo 'require("awful").screen.focused().tags[1]:view_only()' | awesome-client; } \
&& xdotool search --desktop ${DESKTOP:-$CURR_DESK} --class $CLASS windowactivate || exec $RUN

