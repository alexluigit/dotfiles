#!/usr/bin/env zsh
newtab() { local wid=$(__check_brave); [[ -n $wid ]] && __open_newtab $wid || __cleanstart }
music() { local wid=$(__check_music); [[ -n $wid ]] && __window_switch $wid || __openmusic }
refresh() { local wid=$(__check_brave bravedev); [[ -n $wid ]] && __refresh_tab $wid }
dev() { brave --proxy-server="127.0.0.1:1088" --user-data-dir=/home/alex/.config/bravedev --class=bravedev & __rmpki }
second() { export GDK_SCALE=1; export GDK_DPI_SCALE=0.5; brave --proxy-server="127.0.0.1:1088" --user-data-dir=/home/alex/.config/brave2nd --class=brave2nd }

__check_brave() { xdotool search --onlyvisible --desktop $(xdotool get_desktop) --class ${1:-brave} }
__open_newtab() { __window_switch $1; sleep 0.1; __send_key ctrl+t }
__refresh_tab() { __window_switch $1; sleep 0.1; __send_key ctrl+r; __switch_back }
__send_key() { xdotool key --clearmodifiers $1 }
__cleanstart() { brave --proxy-server="127.0.0.1:1088" & __rmpki }
__check_music() { xdotool search --name 'Youtube Music' }
__window_switch() { xdotool windowactivate $1 }
__openmusic() { brave --proxy-server="127.0.0.1:1088" --profile-directory=Default --app-id=cinhimbnkkaeohfgghhklpknlkffjgod & __rmpki }
__rmpki() { sleep 5 && rm -rf ~/.pki }
__switch_back() { bspc node focused -f last }

"$@"
