#!/usr/bin/env zsh
FIX_FLAGS=(--proxy-server="127.0.0.1:1088")
INCOG_FLAGS=(--incognito)
start() { [[ $1 == "1" ]] && FIX_FLAGS+=$INCOG_FLAGS; __cleanstart }
music() { local wid=$(__check_music); [[ -n $wid ]] && __window_switch $wid || __openmusic }
refresh() { local wid=$(__check_brave brave2nd 0); [[ -n $wid ]] && __refresh_tab $wid }
second() { brave "${FIX_FLAGS[@]}" --user-data-dir=/home/alex/.config/brave2nd --class=brave2nd & __rmpki }

__check_brave() { xdotool search --onlyvisible --desktop ${2:-$(xdotool get_desktop)} --class ${1:-brave} }
__refresh_tab() { __window_switch $1; sleep 0.1; __send_key '\Cr'; __switch_back } # same as line above
__send_key() { xvkbd -xsendevent -text $1 }
__cleanstart() { brave "${FIX_FLAGS[@]}" & __rmpki }
__check_music() { xdotool search --name 'Youtube Music' }
__window_switch() { xdotool windowactivate $1 }
__rmpki() { sleep 5 && { [[ -d ~/.pki ]] && rm -rf ~/.pki } }
__switch_back() { bspc node focused -f last }
__openmusic() { brave "${FIX_FLAGS[@]}" --app-id=cinhimbnkkaeohfgghhklpknlkffjgod && __send_key "\[F11]" & __rmpki }

"$@"
